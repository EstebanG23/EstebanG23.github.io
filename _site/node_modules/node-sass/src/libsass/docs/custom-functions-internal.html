<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

<!-- Begin Jekyll SEO tag v2.5.0 -->
<title>Developer Documentation | estebang23.github.io</title>
<meta name="generator" content="Jekyll v3.7.3" />
<meta property="og:title" content="Developer Documentation" />
<meta property="og:locale" content="en_US" />
<link rel="canonical" href="http://localhost:4000/node_modules/node-sass/src/libsass/docs/custom-functions-internal.html" />
<meta property="og:url" content="http://localhost:4000/node_modules/node-sass/src/libsass/docs/custom-functions-internal.html" />
<meta property="og:site_name" content="estebang23.github.io" />
<script type="application/ld+json">
{"@type":"WebPage","url":"http://localhost:4000/node_modules/node-sass/src/libsass/docs/custom-functions-internal.html","headline":"Developer Documentation","@context":"http://schema.org"}</script>
<!-- End Jekyll SEO tag -->

    <link rel="stylesheet" href="/assets/css/style.css?v=08194154e5c3f87742365edb210c0599bab19902">
  </head>
  <body>
    <div class="container-lg px-3 my-5 markdown-body">
      
      <h1><a href="http://localhost:4000/">estebang23.github.io</a></h1>
      

      <h1 id="developer-documentation">Developer Documentation</h1>

<p>Custom functions are internally represented by <code class="highlighter-rouge">struct Sass_C_Function_Descriptor</code>.</p>

<h2 id="sass_c_function_descriptor">Sass_C_Function_Descriptor</h2>

<pre><code class="language-C">struct Sass_C_Function_Descriptor {
  const char*      signature;
  Sass_C_Function  function;
  void*            cookie;
};
</code></pre>

<ul>
  <li><code class="highlighter-rouge">signature</code>: The function declaration, like <code class="highlighter-rouge">foo($bar, $baz:1)</code></li>
  <li><code class="highlighter-rouge">function</code>:  Reference to the C function callback</li>
  <li><code class="highlighter-rouge">cookie</code>:    any pointer you want to attach</li>
</ul>

<h3 id="signature">signature</h3>

<p>The signature defines how the function can be invoked. It also declares which arguments are required and which are optional.  Required arguments will be enforced by LibSass and a Sass error is thrown in the event a call as missing an argument. Optional arguments only need to be present when you want to overwrite the default value.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>foo($bar, $baz: 2)
</code></pre></div></div>

<p>In this example, <code class="highlighter-rouge">$bar</code> is required and will error if not passed. <code class="highlighter-rouge">$baz</code> is optional and the default value of it is 2. A call like <code class="highlighter-rouge">foo(10)</code> is therefore equal to <code class="highlighter-rouge">foo(10, 2)</code>, while <code class="highlighter-rouge">foo()</code> will produce an error.</p>

<h3 id="function">function</h3>

<p>The callback function needs to be of the following form:</p>

<pre><code class="language-C">union Sass_Value* call_sass_function(
    const union Sass_Value* s_args,
    void*                   cookie
) {
  return sass_clone_value(s_args);
}
</code></pre>

<h3 id="cookie">cookie</h3>

<p>The cookie can hold any pointer you want. In the <code class="highlighter-rouge">perl-libsass</code> implementation it holds the structure with the reference of the actual registered callback into the perl interpreter. Before that call <code class="highlighter-rouge">perl-libsass</code> will convert all <code class="highlighter-rouge">Sass_Values</code> to corresponding perl data types (so they can be used natively inside the perl interpretor). The callback can also return a <code class="highlighter-rouge">Sass_Value</code>. In <code class="highlighter-rouge">perl-libsass</code> the actual function returns a perl value, which has to be converted before <code class="highlighter-rouge">libsass</code> can work with it again!</p>

<h2 id="sass_values">Sass_Values</h2>

<pre><code class="language-C">// allocate memory (copies passed strings)
union Sass_Value* sass_make_null    (void);
union Sass_Value* sass_make_boolean (bool val);
union Sass_Value* sass_make_string  (const char* val);
union Sass_Value* sass_make_qstring (const char* val);
union Sass_Value* sass_make_number  (double val, const char* unit);
union Sass_Value* sass_make_color   (double r, double g, double b, double a);
union Sass_Value* sass_make_list    (size_t len, enum Sass_Separator sep, bool is_bracketed);
union Sass_Value* sass_make_map     (size_t len);
union Sass_Value* sass_make_error   (const char* msg);
union Sass_Value* sass_make_warning (const char* msg);

// Make a deep cloned copy of the given sass value
union Sass_Value* sass_clone_value (const union Sass_Value* val);

// deallocate memory (incl. all copied memory)
void sass_delete_value (const union Sass_Value* val);
</code></pre>

<h2 id="example-mainc">Example main.c</h2>

<pre><code class="language-C">#include &lt;stdio.h&gt;
#include &lt;stdint.h&gt;
#include "sass/context.h"

union Sass_Value* call_fn_foo(const union Sass_Value* s_args, void* cookie)
{
  // we actually abuse the void* to store an "int"
  return sass_make_number((size_t)cookie, "px");
}

int main( int argc, const char* argv[] )
{

  // get the input file from first argument or use default
  const char* input = argc &gt; 1 ? argv[1] : "styles.scss";

  // create the file context and get all related structs
  struct Sass_File_Context* file_ctx = sass_make_file_context(input);
  struct Sass_Context* ctx = sass_file_context_get_context(file_ctx);
  struct Sass_Options* ctx_opt = sass_context_get_options(ctx);

  // allocate a custom function caller
  Sass_C_Function_Callback fn_foo =
    sass_make_function("foo()", call_fn_foo, (void*)42);

  // create list of all custom functions
  Sass_C_Function_List fn_list = sass_make_function_list(1);
  sass_function_set_list_entry(fn_list, 0, fn_foo);
  sass_option_set_c_functions(ctx_opt, fn_list);

  // context is set up, call the compile step now
  int status = sass_compile_file_context(file_ctx);

  // print the result or the error to the stdout
  if (status == 0) puts(sass_context_get_output_string(ctx));
  else puts(sass_context_get_error_message(ctx));

  // release allocated memory
  sass_delete_file_context(file_ctx);

  // exit status
  return status;

}
</code></pre>

<h2 id="compile-mainc">Compile main.c</h2>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>gcc <span class="nt">-c</span> main.c <span class="nt">-o</span> main.o
gcc <span class="nt">-o</span> sample main.o <span class="nt">-lsass</span>
<span class="nb">echo</span> <span class="s2">"foo { margin: foo(); }"</span> <span class="o">&gt;</span> foo.scss
./sample foo.scss <span class="o">=&gt;</span> <span class="s2">"foo { margin: 42px }"</span>
</code></pre></div></div>


      
    </div>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/anchor-js/4.1.0/anchor.min.js" integrity="sha256-lZaRhKri35AyJSypXXs4o6OPFTbTmUoltBbDCbdzegg=" crossorigin="anonymous"></script>
    <script>anchors.add();</script>
    
  </body>
</html>
