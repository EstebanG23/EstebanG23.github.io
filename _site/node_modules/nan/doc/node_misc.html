<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

<!-- Begin Jekyll SEO tag v2.5.0 -->
<title>Miscellaneous Node Helpers | estebang23.github.io</title>
<meta name="generator" content="Jekyll v3.7.3" />
<meta property="og:title" content="Miscellaneous Node Helpers" />
<meta property="og:locale" content="en_US" />
<link rel="canonical" href="http://localhost:4000/node_modules/nan/doc/node_misc.html" />
<meta property="og:url" content="http://localhost:4000/node_modules/nan/doc/node_misc.html" />
<meta property="og:site_name" content="estebang23.github.io" />
<script type="application/ld+json">
{"@type":"WebPage","url":"http://localhost:4000/node_modules/nan/doc/node_misc.html","headline":"Miscellaneous Node Helpers","@context":"http://schema.org"}</script>
<!-- End Jekyll SEO tag -->

    <link rel="stylesheet" href="/assets/css/style.css?v=08194154e5c3f87742365edb210c0599bab19902">
  </head>
  <body>
    <div class="container-lg px-3 my-5 markdown-body">
      
      <h1><a href="http://localhost:4000/">estebang23.github.io</a></h1>
      

      <h2 id="miscellaneous-node-helpers">Miscellaneous Node Helpers</h2>

<ul>
  <li><a href="#api_nan_asyncresource"><b><code>Nan::AsyncResource</code></b></a></li>
  <li><a href="#api_nan_make_callback"><b><code>Nan::MakeCallback()</code></b></a></li>
  <li><a href="#api_nan_module_init"><b><code>NAN_MODULE_INIT()</code></b></a></li>
  <li><a href="#api_nan_export"><b><code>Nan::Export()</code></b></a></li>
</ul>

<p><a name="api_nan_asyncresource"></a></p>
<h3 id="nanasyncresource">Nan::AsyncResource</h3>

<p>This class is analogous to the <code class="highlighter-rouge">AsyncResource</code> JavaScript class exposed by Nodeâ€™s <a href="https://nodejs.org/dist/latest-v9.x/docs/api/async_hooks.html">async_hooks</a> API.</p>

<p>When calling back into JavaScript asynchornously, special care must be taken to ensure that the runtime can properly track
async hops. <code class="highlighter-rouge">Nan::AsyncResource</code> is a class that provides an RAII wrapper around <code class="highlighter-rouge">node::EmitAsyncInit</code>, <code class="highlighter-rouge">node::EmitAsyncDestroy</code>,
and <code class="highlighter-rouge">node::MakeCallback</code>. Using this mechanism to call back into JavaScript, as opposed to <code class="highlighter-rouge">Nan::MakeCallback</code> or
<code class="highlighter-rouge">v8::Function::Call</code> ensures that the callback is executed in the correct async context. This ensures that async mechanisms
such as domains and <a href="https://nodejs.org/dist/latest-v9.x/docs/api/async_hooks.html">async_hooks</a> function correctly.</p>

<p>Definition:</p>

<div class="language-c++ highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">AsyncResource</span> <span class="p">{</span>
 <span class="k">public</span><span class="o">:</span>
  <span class="n">AsyncResource</span><span class="p">(</span><span class="n">v8</span><span class="o">::</span><span class="n">Local</span><span class="o">&lt;</span><span class="n">v8</span><span class="o">::</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">name</span><span class="p">,</span>
                <span class="n">v8</span><span class="o">::</span><span class="n">Local</span><span class="o">&lt;</span><span class="n">v8</span><span class="o">::</span><span class="n">Object</span><span class="o">&gt;</span> <span class="n">resource</span> <span class="o">=</span> <span class="n">New</span><span class="o">&lt;</span><span class="n">v8</span><span class="o">::</span><span class="n">Object</span><span class="o">&gt;</span><span class="p">());</span>
  <span class="n">AsyncResource</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">name</span><span class="p">,</span>
                <span class="n">v8</span><span class="o">::</span><span class="n">Local</span><span class="o">&lt;</span><span class="n">v8</span><span class="o">::</span><span class="n">Object</span><span class="o">&gt;</span> <span class="n">resource</span> <span class="o">=</span> <span class="n">New</span><span class="o">&lt;</span><span class="n">v8</span><span class="o">::</span><span class="n">Object</span><span class="o">&gt;</span><span class="p">());</span>
  <span class="o">~</span><span class="n">AsyncResource</span><span class="p">();</span>

  <span class="n">v8</span><span class="o">::</span><span class="n">MaybeLocal</span><span class="o">&lt;</span><span class="n">v8</span><span class="o">::</span><span class="n">Value</span><span class="o">&gt;</span> <span class="n">runInAsyncScope</span><span class="p">(</span><span class="n">v8</span><span class="o">::</span><span class="n">Local</span><span class="o">&lt;</span><span class="n">v8</span><span class="o">::</span><span class="n">Object</span><span class="o">&gt;</span> <span class="n">target</span><span class="p">,</span>
                                            <span class="n">v8</span><span class="o">::</span><span class="n">Local</span><span class="o">&lt;</span><span class="n">v8</span><span class="o">::</span><span class="n">Function</span><span class="o">&gt;</span> <span class="n">func</span><span class="p">,</span>
                                            <span class="kt">int</span> <span class="n">argc</span><span class="p">,</span>
                                            <span class="n">v8</span><span class="o">::</span><span class="n">Local</span><span class="o">&lt;</span><span class="n">v8</span><span class="o">::</span><span class="n">Value</span><span class="o">&gt;*</span> <span class="n">argv</span><span class="p">);</span>
  <span class="n">v8</span><span class="o">::</span><span class="n">MaybeLocal</span><span class="o">&lt;</span><span class="n">v8</span><span class="o">::</span><span class="n">Value</span><span class="o">&gt;</span> <span class="n">runInAsyncScope</span><span class="p">(</span><span class="n">v8</span><span class="o">::</span><span class="n">Local</span><span class="o">&lt;</span><span class="n">v8</span><span class="o">::</span><span class="n">Object</span><span class="o">&gt;</span> <span class="n">target</span><span class="p">,</span>
                                            <span class="n">v8</span><span class="o">::</span><span class="n">Local</span><span class="o">&lt;</span><span class="n">v8</span><span class="o">::</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">symbol</span><span class="p">,</span>
                                            <span class="kt">int</span> <span class="n">argc</span><span class="p">,</span>
                                            <span class="n">v8</span><span class="o">::</span><span class="n">Local</span><span class="o">&lt;</span><span class="n">v8</span><span class="o">::</span><span class="n">Value</span><span class="o">&gt;*</span> <span class="n">argv</span><span class="p">);</span>
  <span class="n">v8</span><span class="o">::</span><span class="n">MaybeLocal</span><span class="o">&lt;</span><span class="n">v8</span><span class="o">::</span><span class="n">Value</span><span class="o">&gt;</span> <span class="n">runInAsyncScope</span><span class="p">(</span><span class="n">v8</span><span class="o">::</span><span class="n">Local</span><span class="o">&lt;</span><span class="n">v8</span><span class="o">::</span><span class="n">Object</span><span class="o">&gt;</span> <span class="n">target</span><span class="p">,</span>
                                            <span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">method</span><span class="p">,</span>
                                            <span class="kt">int</span> <span class="n">argc</span><span class="p">,</span>
                                            <span class="n">v8</span><span class="o">::</span><span class="n">Local</span><span class="o">&lt;</span><span class="n">v8</span><span class="o">::</span><span class="n">Value</span><span class="o">&gt;*</span> <span class="n">argv</span><span class="p">);</span>
<span class="p">};</span>
</code></pre></div></div>

<ul>
  <li><code class="highlighter-rouge">name</code>: Identifier for the kind of resource that is being provided for diagnostics information exposed by the <a href="https://nodejs.org/dist/latest-v9.x/docs/api/async_hooks.html">async_hooks</a>
API. This will be passed to the possible <code class="highlighter-rouge">init</code> hook as the <code class="highlighter-rouge">type</code>. To avoid name collisions with other modules we recommend
that the name include the name of the owning module as a prefix. For example <code class="highlighter-rouge">mysql</code> module could use something like
<code class="highlighter-rouge">mysql:batch-db-query-resource</code>.</li>
  <li><code class="highlighter-rouge">resource</code>: An optional object associated with the async work that will be passed to the possible <a href="https://nodejs.org/dist/latest-v9.x/docs/api/async_hooks.html">async_hooks</a>
<code class="highlighter-rouge">init</code> hook. If this parameter is omitted, or an empty handle is provided, this object will be created automatically.</li>
  <li>When calling JS on behalf of this resource, one can use <code class="highlighter-rouge">runInAsyncScope</code>. This will ensure that the callback runs in the
correct async execution context.</li>
  <li><code class="highlighter-rouge">AsyncDestroy</code> is automatically called when an AsyncResource object is destroyed.</li>
</ul>

<p>For more details, see the Node <a href="https://nodejs.org/dist/latest-v9.x/docs/api/async_hooks.html">async_hooks</a> documentation. You might also want to take a look at the documentation for the
<a href="https://nodejs.org/dist/latest-v9.x/docs/api/n-api.html#n_api_custom_asynchronous_operations">N-API counterpart</a>. For example usage, see the <code class="highlighter-rouge">asyncresource.cpp</code> example in the <code class="highlighter-rouge">test/cpp</code> directory.</p>

<p><a name="api_nan_make_callback"></a></p>
<h3 id="nanmakecallback">Nan::MakeCallback()</h3>

<p>Deprecated wrappers around the legacy <code class="highlighter-rouge">node::MakeCallback()</code> APIs. Node.js 10+
has deprecated these legacy APIs as they do not provide a mechanism to preserve
async context.</p>

<p>We recommend that you use the <code class="highlighter-rouge">AsyncResource</code> class and <code class="highlighter-rouge">AsyncResource::runInAsyncScope</code> instead of using <code class="highlighter-rouge">Nan::MakeCallback</code> or
<code class="highlighter-rouge">v8::Function#Call()</code> directly. <code class="highlighter-rouge">AsyncResource</code> properly takes care of running the callback in the correct async execution
context â€“ something that is essential for functionality like domains, async_hooks and async debugging.</p>

<p>Signatures:</p>

<div class="language-c++ highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">NAN_DEPRECATED</span>
<span class="n">v8</span><span class="o">::</span><span class="n">Local</span><span class="o">&lt;</span><span class="n">v8</span><span class="o">::</span><span class="n">Value</span><span class="o">&gt;</span> <span class="n">Nan</span><span class="o">::</span><span class="n">MakeCallback</span><span class="p">(</span><span class="n">v8</span><span class="o">::</span><span class="n">Local</span><span class="o">&lt;</span><span class="n">v8</span><span class="o">::</span><span class="n">Object</span><span class="o">&gt;</span> <span class="n">target</span><span class="p">,</span>
                                       <span class="n">v8</span><span class="o">::</span><span class="n">Local</span><span class="o">&lt;</span><span class="n">v8</span><span class="o">::</span><span class="n">Function</span><span class="o">&gt;</span> <span class="n">func</span><span class="p">,</span>
                                       <span class="kt">int</span> <span class="n">argc</span><span class="p">,</span>
                                       <span class="n">v8</span><span class="o">::</span><span class="n">Local</span><span class="o">&lt;</span><span class="n">v8</span><span class="o">::</span><span class="n">Value</span><span class="o">&gt;*</span> <span class="n">argv</span><span class="p">);</span>
<span class="n">NAN_DEPRECATED</span>
<span class="n">v8</span><span class="o">::</span><span class="n">Local</span><span class="o">&lt;</span><span class="n">v8</span><span class="o">::</span><span class="n">Value</span><span class="o">&gt;</span> <span class="n">Nan</span><span class="o">::</span><span class="n">MakeCallback</span><span class="p">(</span><span class="n">v8</span><span class="o">::</span><span class="n">Local</span><span class="o">&lt;</span><span class="n">v8</span><span class="o">::</span><span class="n">Object</span><span class="o">&gt;</span> <span class="n">target</span><span class="p">,</span>
                                       <span class="n">v8</span><span class="o">::</span><span class="n">Local</span><span class="o">&lt;</span><span class="n">v8</span><span class="o">::</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">symbol</span><span class="p">,</span>
                                       <span class="kt">int</span> <span class="n">argc</span><span class="p">,</span>
                                       <span class="n">v8</span><span class="o">::</span><span class="n">Local</span><span class="o">&lt;</span><span class="n">v8</span><span class="o">::</span><span class="n">Value</span><span class="o">&gt;*</span> <span class="n">argv</span><span class="p">);</span>
<span class="n">NAN_DEPRECATED</span>
<span class="n">v8</span><span class="o">::</span><span class="n">Local</span><span class="o">&lt;</span><span class="n">v8</span><span class="o">::</span><span class="n">Value</span><span class="o">&gt;</span> <span class="n">Nan</span><span class="o">::</span><span class="n">MakeCallback</span><span class="p">(</span><span class="n">v8</span><span class="o">::</span><span class="n">Local</span><span class="o">&lt;</span><span class="n">v8</span><span class="o">::</span><span class="n">Object</span><span class="o">&gt;</span> <span class="n">target</span><span class="p">,</span>
                                       <span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">method</span><span class="p">,</span>
                                       <span class="kt">int</span> <span class="n">argc</span><span class="p">,</span>
                                       <span class="n">v8</span><span class="o">::</span><span class="n">Local</span><span class="o">&lt;</span><span class="n">v8</span><span class="o">::</span><span class="n">Value</span><span class="o">&gt;*</span> <span class="n">argv</span><span class="p">);</span>
</code></pre></div></div>

<p><a name="api_nan_module_init"></a></p>
<h3 id="nan_module_init">NAN_MODULE_INIT()</h3>

<p>Used to define the entry point function to a Node add-on. Creates a function with a given <code class="highlighter-rouge">name</code> that receives a <code class="highlighter-rouge">target</code> object representing the equivalent of the JavaScript <code class="highlighter-rouge">exports</code> object.</p>

<p>See example below.</p>

<p><a name="api_nan_export"></a></p>
<h3 id="nanexport">Nan::Export()</h3>

<p>A simple helper to register a <code class="highlighter-rouge">v8::FunctionTemplate</code> from a JavaScript-accessible method (see <a href="/node_modules/nan/doc/methods.html">Methods</a>) as a property on an object. Can be used in a way similar to assigning properties to <code class="highlighter-rouge">module.exports</code> in JavaScript.</p>

<p>Signature:</p>

<div class="language-c++ highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">void</span> <span class="n">Export</span><span class="p">(</span><span class="n">v8</span><span class="o">::</span><span class="n">Local</span><span class="o">&lt;</span><span class="n">v8</span><span class="o">::</span><span class="n">Object</span><span class="o">&gt;</span> <span class="n">target</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">name</span><span class="p">,</span> <span class="n">Nan</span><span class="o">::</span><span class="n">FunctionCallback</span> <span class="n">f</span><span class="p">)</span>
</code></pre></div></div>

<p>Also available as the shortcut <code class="highlighter-rouge">NAN_EXPORT</code> macro.</p>

<p>Example:</p>

<div class="language-c++ highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">NAN_METHOD</span><span class="p">(</span><span class="n">Foo</span><span class="p">)</span> <span class="p">{</span>
  <span class="p">...</span>
<span class="p">}</span>

<span class="n">NAN_MODULE_INIT</span><span class="p">(</span><span class="n">Init</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">NAN_EXPORT</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="n">Foo</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div></div>



      
    </div>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/anchor-js/4.1.0/anchor.min.js" integrity="sha256-lZaRhKri35AyJSypXXs4o6OPFTbTmUoltBbDCbdzegg=" crossorigin="anonymous"></script>
    <script>anchors.add();</script>
    
  </body>
</html>
