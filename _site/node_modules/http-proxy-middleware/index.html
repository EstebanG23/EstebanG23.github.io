<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

<!-- Begin Jekyll SEO tag v2.5.0 -->
<title>http-proxy-middleware | estebang23.github.io</title>
<meta name="generator" content="Jekyll v3.7.3" />
<meta property="og:title" content="http-proxy-middleware" />
<meta property="og:locale" content="en_US" />
<link rel="canonical" href="http://localhost:4000/node_modules/http-proxy-middleware/" />
<meta property="og:url" content="http://localhost:4000/node_modules/http-proxy-middleware/" />
<meta property="og:site_name" content="estebang23.github.io" />
<script type="application/ld+json">
{"@type":"WebPage","url":"http://localhost:4000/node_modules/http-proxy-middleware/","headline":"http-proxy-middleware","@context":"http://schema.org"}</script>
<!-- End Jekyll SEO tag -->

    <link rel="stylesheet" href="/assets/css/style.css?v=08194154e5c3f87742365edb210c0599bab19902">
  </head>
  <body>
    <div class="container-lg px-3 my-5 markdown-body">
      
      <h1><a href="http://localhost:4000/">estebang23.github.io</a></h1>
      

      <h1 id="http-proxy-middleware">http-proxy-middleware</h1>

<p><a href="https://travis-ci.org/chimurai/http-proxy-middleware"><img src="https://img.shields.io/travis/chimurai/http-proxy-middleware/master.svg?style=flat-square" alt="Build Status" /></a>
<a href="https://coveralls.io/r/chimurai/http-proxy-middleware"><img src="https://img.shields.io/coveralls/chimurai/http-proxy-middleware.svg?style=flat-square" alt="Coveralls" /></a>
<a href="https://david-dm.org/chimurai/http-proxy-middleware#info=dependencies"><img src="https://img.shields.io/david/chimurai/http-proxy-middleware.svg?style=flat-square" alt="dependency Status" /></a>
<a href="https://snyk.io/test/npm/http-proxy-middleware"><img src="https://snyk.io/test/npm/http-proxy-middleware/badge.svg" alt="dependency Status" /></a></p>

<p>Node.js proxying made simple. Configure proxy middleware with ease for <a href="https://github.com/senchalabs/connect">connect</a>, <a href="https://github.com/strongloop/express">express</a>, <a href="https://github.com/BrowserSync/browser-sync">browser-sync</a> and <a href="#compatible-servers">many more</a>.</p>

<p>Powered by the popular Nodejitsu <a href="https://github.com/nodejitsu/node-http-proxy"><code class="highlighter-rouge">http-proxy</code></a>. <a href="https://github.com/nodejitsu/node-http-proxy"><img src="https://img.shields.io/github/stars/nodejitsu/node-http-proxy.svg?style=social&amp;label=Star" alt="GitHub stars" /></a></p>

<h2 id="tldr">TL;DR</h2>

<p>Proxy <code class="highlighter-rouge">/api</code> requests to <code class="highlighter-rouge">http://www.example.org</code></p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">var</span> <span class="nx">express</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'express'</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">proxy</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'http-proxy-middleware'</span><span class="p">);</span>

<span class="kd">var</span> <span class="nx">app</span> <span class="o">=</span> <span class="nx">express</span><span class="p">();</span>

<span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="s1">'/api'</span><span class="p">,</span> <span class="nx">proxy</span><span class="p">({</span><span class="na">target</span><span class="p">:</span> <span class="s1">'http://www.example.org'</span><span class="p">,</span> <span class="na">changeOrigin</span><span class="p">:</span> <span class="kc">true</span><span class="p">}));</span>
<span class="nx">app</span><span class="p">.</span><span class="nx">listen</span><span class="p">(</span><span class="mi">3000</span><span class="p">);</span>

<span class="c1">// http://localhost:3000/api/foo/bar -&gt; http://www.example.org/api/foo/bar</span>
</code></pre></div></div>

<p><em>All</em> <code class="highlighter-rouge">http-proxy</code> <a href="https://github.com/nodejitsu/node-http-proxy#options">options</a> can be used, along with some extra <code class="highlighter-rouge">http-proxy-middleware</code> <a href="#options">options</a>.</p>

<p>:bulb: <strong>Tip:</strong> Set the option <code class="highlighter-rouge">changeOrigin</code> to <code class="highlighter-rouge">true</code> for <a href="http://en.wikipedia.org/wiki/Virtual_hosting#Name-based">name-based virtual hosted sites</a>.</p>

<h2 id="table-of-contents">Table of Contents</h2>

<!-- MarkdownTOC autolink=true bracket=round depth=2 -->

<ul>
  <li><a href="#install">Install</a></li>
  <li><a href="#core-concept">Core concept</a></li>
  <li><a href="#example">Example</a></li>
  <li><a href="#context-matching">Context matching</a></li>
  <li><a href="#options">Options</a>
    <ul>
      <li><a href="#http-proxy-middleware-options">http-proxy-middleware options</a></li>
      <li><a href="#http-proxy-events">http-proxy events</a></li>
      <li><a href="#http-proxy-options">http-proxy options</a></li>
    </ul>
  </li>
  <li><a href="#shorthand">Shorthand</a>
    <ul>
      <li><a href="#appusepath-proxy">app.use(path, proxy)</a></li>
    </ul>
  </li>
  <li><a href="#websocket">WebSocket</a>
    <ul>
      <li><a href="#external-websocket-upgrade">External WebSocket upgrade</a></li>
    </ul>
  </li>
  <li><a href="#working-examples">Working examples</a></li>
  <li><a href="#recipes">Recipes</a></li>
  <li><a href="#compatible-servers">Compatible servers</a></li>
  <li><a href="#tests">Tests</a></li>
  <li><a href="#changelog">Changelog</a></li>
  <li><a href="#license">License</a></li>
</ul>

<!-- /MarkdownTOC -->

<h2 id="install">Install</h2>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">$</span> <span class="nx">npm</span> <span class="nx">install</span> <span class="o">--</span><span class="nx">save</span><span class="o">-</span><span class="nx">dev</span> <span class="nx">http</span><span class="o">-</span><span class="nx">proxy</span><span class="o">-</span><span class="nx">middleware</span>
</code></pre></div></div>

<h2 id="core-concept">Core concept</h2>

<p>Proxy middleware configuration.</p>

<h4 id="proxycontext-config">proxy([context,] config)</h4>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">var</span> <span class="nx">proxy</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'http-proxy-middleware'</span><span class="p">);</span>

<span class="kd">var</span> <span class="nx">apiProxy</span> <span class="o">=</span> <span class="nx">proxy</span><span class="p">(</span><span class="s1">'/api'</span><span class="p">,</span> <span class="p">{</span><span class="na">target</span><span class="p">:</span> <span class="s1">'http://www.example.org'</span><span class="p">});</span>
<span class="c1">//                   \____/   \_____________________________/</span>
<span class="c1">//                     |                    |</span>
<span class="c1">//                   context             options</span>

<span class="c1">// 'apiProxy' is now ready to be used as middleware in a server.</span>
</code></pre></div></div>
<ul>
  <li><strong>context</strong>: Determine which requests should be proxied to the target host.
  (more on <a href="#context-matching">context matching</a>)</li>
  <li><strong>options.target</strong>: target host to proxy to. <em>(protocol + host)</em></li>
</ul>

<p>(full list of <a href="#options"><code class="highlighter-rouge">http-proxy-middleware</code> configuration options</a>)</p>

<h4 id="proxyuri--config">proxy(uri [, config])</h4>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// shorthand syntax for the example above:</span>
<span class="kd">var</span> <span class="nx">apiProxy</span> <span class="o">=</span> <span class="nx">proxy</span><span class="p">(</span><span class="s1">'http://www.example.org/api'</span><span class="p">);</span>

</code></pre></div></div>
<p>More about the <a href="#shorthand">shorthand configuration</a>.</p>

<h2 id="example">Example</h2>

<p>An example with <code class="highlighter-rouge">express</code> server.</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// include dependencies</span>
<span class="kd">var</span> <span class="nx">express</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'express'</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">proxy</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'http-proxy-middleware'</span><span class="p">);</span>

<span class="c1">// proxy middleware options</span>
<span class="kd">var</span> <span class="nx">options</span> <span class="o">=</span> <span class="p">{</span>
        <span class="na">target</span><span class="p">:</span> <span class="s1">'http://www.example.org'</span><span class="p">,</span> <span class="c1">// target host</span>
        <span class="na">changeOrigin</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>               <span class="c1">// needed for virtual hosted sites</span>
        <span class="na">ws</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>                         <span class="c1">// proxy websockets</span>
        <span class="na">pathRewrite</span><span class="p">:</span> <span class="p">{</span>
            <span class="s1">'^/api/old-path'</span> <span class="p">:</span> <span class="s1">'/api/new-path'</span><span class="p">,</span>     <span class="c1">// rewrite path</span>
            <span class="s1">'^/api/remove/path'</span> <span class="p">:</span> <span class="s1">'/path'</span>           <span class="c1">// remove base path</span>
        <span class="p">},</span>
        <span class="na">router</span><span class="p">:</span> <span class="p">{</span>
            <span class="c1">// when request.headers.host == 'dev.localhost:3000',</span>
            <span class="c1">// override target 'http://www.example.org' to 'http://localhost:8000'</span>
            <span class="s1">'dev.localhost:3000'</span> <span class="p">:</span> <span class="s1">'http://localhost:8000'</span>
        <span class="p">}</span>
    <span class="p">};</span>

<span class="c1">// create the proxy (without context)</span>
<span class="kd">var</span> <span class="nx">exampleProxy</span> <span class="o">=</span> <span class="nx">proxy</span><span class="p">(</span><span class="nx">options</span><span class="p">);</span>

<span class="c1">// mount `exampleProxy` in web server</span>
<span class="kd">var</span> <span class="nx">app</span> <span class="o">=</span> <span class="nx">express</span><span class="p">();</span>
    <span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="s1">'/api'</span><span class="p">,</span> <span class="nx">exampleProxy</span><span class="p">);</span>
    <span class="nx">app</span><span class="p">.</span><span class="nx">listen</span><span class="p">(</span><span class="mi">3000</span><span class="p">);</span>
</code></pre></div></div>

<h2 id="context-matching">Context matching</h2>

<p>Providing an alternative way to decide which requests should be proxied; In case you are not able to use the server’s <a href="http://expressjs.com/en/4x/api.html#app.use"><code class="highlighter-rouge">path</code> parameter</a> to mount the proxy or when you need more flexibility.</p>

<p>The <a href="https://tools.ietf.org/html/rfc3986#section-3.3">RFC 3986 <code class="highlighter-rouge">path</code></a> is be used for context matching.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>         foo://example.com:8042/over/there?name=ferret#nose
         \_/   \______________/\_________/ \_________/ \__/
          |           |            |            |        |
       scheme     authority       path        query   fragment
</code></pre></div></div>

<ul>
  <li><strong>path matching</strong>
    <ul>
      <li><code class="highlighter-rouge">proxy({...})</code> - matches any path, all requests will be proxied.</li>
      <li><code class="highlighter-rouge">proxy('/', {...})</code> - matches any path, all requests will be proxied.</li>
      <li><code class="highlighter-rouge">proxy('/api', {...})</code> - matches paths starting with <code class="highlighter-rouge">/api</code></li>
    </ul>
  </li>
  <li><strong>multiple path matching</strong>
    <ul>
      <li><code class="highlighter-rouge">proxy(['/api', '/ajax', '/someotherpath'], {...})</code></li>
    </ul>
  </li>
  <li>
    <p><strong>wildcard path matching</strong></p>

    <p>For fine-grained control you can use wildcard matching. Glob pattern matching is done by <em>micromatch</em>. Visit <a href="https://www.npmjs.com/package/micromatch">micromatch</a> or <a href="https://www.npmjs.com/package/glob">glob</a> for more globbing examples.</p>
    <ul>
      <li><code class="highlighter-rouge">proxy('**', {...})</code> matches any path, all requests will be proxied.</li>
      <li><code class="highlighter-rouge">proxy('**/*.html', {...})</code> matches any path which ends with <code class="highlighter-rouge">.html</code></li>
      <li><code class="highlighter-rouge">proxy('/*.html', {...})</code> matches paths directly under path-absolute</li>
      <li><code class="highlighter-rouge">proxy('/api/**/*.html', {...})</code> matches requests ending with <code class="highlighter-rouge">.html</code> in the path of <code class="highlighter-rouge">/api</code></li>
      <li><code class="highlighter-rouge">proxy(['/api/**', '/ajax/**'], {...})</code> combine multiple patterns</li>
      <li><code class="highlighter-rouge">proxy(['/api/**', '!**/bad.json'], {...})</code> exclusion</li>
    </ul>
  </li>
  <li>
    <p><strong>custom matching</strong></p>

    <p>For full control you can provide a custom function to determine which requests should be proxied or not.</p>
    <div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="cm">/**
   * @return {Boolean}
   */</span>
  <span class="kd">var</span> <span class="nx">filter</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">pathname</span><span class="p">,</span> <span class="nx">req</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="p">(</span><span class="nx">pathname</span><span class="p">.</span><span class="nx">match</span><span class="p">(</span><span class="s1">'^/api'</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="nx">req</span><span class="p">.</span><span class="nx">method</span> <span class="o">===</span> <span class="s1">'GET'</span><span class="p">);</span>
  <span class="p">};</span>

  <span class="kd">var</span> <span class="nx">apiProxy</span> <span class="o">=</span> <span class="nx">proxy</span><span class="p">(</span><span class="nx">filter</span><span class="p">,</span> <span class="p">{</span><span class="na">target</span><span class="p">:</span> <span class="s1">'http://www.example.org'</span><span class="p">})</span>
</code></pre></div>    </div>
  </li>
</ul>

<h2 id="options">Options</h2>

<h3 id="http-proxy-middleware-options">http-proxy-middleware options</h3>

<ul>
  <li><strong>option.pathRewrite</strong>: object/function, rewrite target’s url path. Object-keys will be used as <em>RegExp</em> to match paths.
    <div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="c1">// rewrite path</span>
 <span class="nx">pathRewrite</span><span class="p">:</span> <span class="p">{</span><span class="s1">'^/old/api'</span> <span class="p">:</span> <span class="s1">'/new/api'</span><span class="p">}</span>
    
 <span class="c1">// remove path</span>
 <span class="nl">pathRewrite</span><span class="p">:</span> <span class="p">{</span><span class="s1">'^/remove/api'</span> <span class="p">:</span> <span class="s1">''</span><span class="p">}</span>
    
 <span class="c1">// add base path</span>
 <span class="nl">pathRewrite</span><span class="p">:</span> <span class="p">{</span><span class="s1">'^/'</span> <span class="p">:</span> <span class="s1">'/basepath/'</span><span class="p">}</span>

 <span class="c1">// custom rewriting</span>
 <span class="nl">pathRewrite</span><span class="p">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">path</span><span class="p">,</span> <span class="nx">req</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="nx">path</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="s1">'/api'</span><span class="p">,</span> <span class="s1">'/base/api'</span><span class="p">)</span> <span class="p">}</span>
</code></pre></div>    </div>
  </li>
  <li><strong>option.router</strong>: object/function, re-target <code class="highlighter-rouge">option.target</code> for specific requests.
    <div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="c1">// Use `host` and/or `path` to match requests. First match will be used.</span>
  <span class="c1">// The order of the configuration matters.</span>
  <span class="nx">router</span><span class="p">:</span> <span class="p">{</span>
      <span class="s1">'integration.localhost:3000'</span> <span class="p">:</span> <span class="s1">'http://localhost:8001'</span><span class="p">,</span>  <span class="c1">// host only</span>
      <span class="s1">'staging.localhost:3000'</span>     <span class="p">:</span> <span class="s1">'http://localhost:8002'</span><span class="p">,</span>  <span class="c1">// host only</span>
      <span class="s1">'localhost:3000/api'</span>         <span class="p">:</span> <span class="s1">'http://localhost:8003'</span><span class="p">,</span>  <span class="c1">// host + path</span>
      <span class="s1">'/rest'</span>                      <span class="p">:</span> <span class="s1">'http://localhost:8004'</span>   <span class="c1">// path only</span>
  <span class="p">}</span>

  <span class="c1">// Custom router function</span>
  <span class="nl">router</span><span class="p">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">req</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="s1">'http://localhost:8004'</span><span class="p">;</span>
  <span class="p">}</span>
</code></pre></div>    </div>
  </li>
  <li>
    <p><strong>option.logLevel</strong>: string, [‘debug’, ‘info’, ‘warn’, ‘error’, ‘silent’]. Default: <code class="highlighter-rouge">'info'</code></p>
  </li>
  <li><strong>option.logProvider</strong>: function, modify or replace log provider. Default: <code class="highlighter-rouge">console</code>.
    <div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="c1">// simple replace</span>
 <span class="kd">function</span> <span class="nx">logProvider</span><span class="p">(</span><span class="nx">provider</span><span class="p">)</span> <span class="p">{</span>
     <span class="c1">// replace the default console log provider.</span>
     <span class="k">return</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'winston'</span><span class="p">);</span>
 <span class="p">}</span>
</code></pre></div>    </div>

    <div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="c1">// verbose replacement</span>
 <span class="kd">function</span> <span class="nx">logProvider</span><span class="p">(</span><span class="nx">provider</span><span class="p">)</span> <span class="p">{</span>
     <span class="kd">var</span> <span class="nx">logger</span> <span class="o">=</span> <span class="k">new</span> <span class="p">(</span><span class="nx">require</span><span class="p">(</span><span class="s1">'winston'</span><span class="p">).</span><span class="nx">Logger</span><span class="p">)();</span>

     <span class="kd">var</span> <span class="nx">myCustomProvider</span> <span class="o">=</span> <span class="p">{</span>
         <span class="na">log</span><span class="p">:</span> <span class="nx">logger</span><span class="p">.</span><span class="nx">log</span><span class="p">,</span>
         <span class="na">debug</span><span class="p">:</span> <span class="nx">logger</span><span class="p">.</span><span class="nx">debug</span><span class="p">,</span>
         <span class="na">info</span><span class="p">:</span> <span class="nx">logger</span><span class="p">.</span><span class="nx">info</span><span class="p">,</span>
         <span class="na">warn</span><span class="p">:</span> <span class="nx">logger</span><span class="p">.</span><span class="nx">warn</span><span class="p">,</span>
         <span class="na">error</span><span class="p">:</span> <span class="nx">logger</span><span class="p">.</span><span class="nx">error</span>
     <span class="p">}</span>
     <span class="k">return</span> <span class="nx">myCustomProvider</span><span class="p">;</span>
 <span class="p">}</span>
</code></pre></div>    </div>
  </li>
  <li>(DEPRECATED) <strong>option.proxyHost</strong>: Use <code class="highlighter-rouge">option.changeOrigin = true</code> instead.</li>
  <li>(DEPRECATED) <strong>option.proxyTable</strong>: Use <code class="highlighter-rouge">option.router</code> instead.</li>
</ul>

<h3 id="http-proxy-events">http-proxy events</h3>

<p>Subscribe to <a href="https://github.com/nodejitsu/node-http-proxy#listening-for-proxy-events">http-proxy events</a>:</p>

<ul>
  <li><strong>option.onError</strong>: function, subscribe to http-proxy’s <code class="highlighter-rouge">error</code> event for custom error handling.
    <div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="kd">function</span> <span class="nx">onError</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="p">{</span>
     <span class="nx">res</span><span class="p">.</span><span class="nx">writeHead</span><span class="p">(</span><span class="mi">500</span><span class="p">,</span> <span class="p">{</span>
         <span class="s1">'Content-Type'</span><span class="p">:</span> <span class="s1">'text/plain'</span>
     <span class="p">});</span>
     <span class="nx">res</span><span class="p">.</span><span class="nx">end</span><span class="p">(</span><span class="s1">'Something went wrong. And we are reporting a custom error message.'</span><span class="p">);</span>
 <span class="p">}</span>
</code></pre></div>    </div>
  </li>
  <li><strong>option.onProxyRes</strong>: function, subscribe to http-proxy’s <code class="highlighter-rouge">proxyRes</code> event.
    <div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="kd">function</span> <span class="nx">onProxyRes</span><span class="p">(</span><span class="nx">proxyRes</span><span class="p">,</span> <span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="p">{</span>
     <span class="nx">proxyRes</span><span class="p">.</span><span class="nx">headers</span><span class="p">[</span><span class="s1">'x-added'</span><span class="p">]</span> <span class="o">=</span> <span class="s1">'foobar'</span><span class="p">;</span>     <span class="c1">// add new header to response</span>
     <span class="k">delete</span> <span class="nx">proxyRes</span><span class="p">.</span><span class="nx">headers</span><span class="p">[</span><span class="s1">'x-removed'</span><span class="p">];</span>       <span class="c1">// remove header from response</span>
 <span class="p">}</span>
</code></pre></div>    </div>
  </li>
  <li><strong>option.onProxyReq</strong>: function, subscribe to http-proxy’s <code class="highlighter-rouge">proxyReq</code> event.
    <div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="kd">function</span> <span class="nx">onProxyReq</span><span class="p">(</span><span class="nx">proxyReq</span><span class="p">,</span> <span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="p">{</span>
     <span class="c1">// add custom header to request</span>
     <span class="nx">proxyReq</span><span class="p">.</span><span class="nx">setHeader</span><span class="p">(</span><span class="s1">'x-added'</span><span class="p">,</span> <span class="s1">'foobar'</span><span class="p">);</span>
     <span class="c1">// or log the req</span>
 <span class="p">}</span>
</code></pre></div>    </div>
  </li>
  <li><strong>option.onProxyReqWs</strong>: function, subscribe to http-proxy’s <code class="highlighter-rouge">proxyReqWs</code> event.
    <div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="kd">function</span> <span class="nx">onProxyReqWs</span><span class="p">(</span><span class="nx">proxyReq</span><span class="p">,</span> <span class="nx">req</span><span class="p">,</span> <span class="nx">socket</span><span class="p">,</span> <span class="nx">options</span><span class="p">,</span> <span class="nx">head</span><span class="p">)</span> <span class="p">{</span>
     <span class="c1">// add custom header</span>
     <span class="nx">proxyReq</span><span class="p">.</span><span class="nx">setHeader</span><span class="p">(</span><span class="s1">'X-Special-Proxy-Header'</span><span class="p">,</span> <span class="s1">'foobar'</span><span class="p">);</span>
 <span class="p">}</span>
</code></pre></div>    </div>
  </li>
  <li><strong>option.onOpen</strong>: function, subscribe to http-proxy’s <code class="highlighter-rouge">open</code> event.
    <div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="kd">function</span> <span class="nx">onOpen</span><span class="p">(</span><span class="nx">proxySocket</span><span class="p">)</span> <span class="p">{</span>
     <span class="c1">// listen for messages coming FROM the target here</span>
     <span class="nx">proxySocket</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">'data'</span><span class="p">,</span> <span class="nx">hybiParseAndLogMessage</span><span class="p">);</span>
 <span class="p">}</span>
</code></pre></div>    </div>
  </li>
  <li><strong>option.onClose</strong>: function, subscribe to http-proxy’s <code class="highlighter-rouge">close</code> event.
    <div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="kd">function</span> <span class="nx">onClose</span><span class="p">(</span><span class="nx">res</span><span class="p">,</span> <span class="nx">socket</span><span class="p">,</span> <span class="nx">head</span><span class="p">)</span> <span class="p">{</span>
     <span class="c1">// view disconnected websocket connections</span>
     <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">'Client disconnected'</span><span class="p">);</span>
 <span class="p">}</span>
</code></pre></div>    </div>
  </li>
</ul>

<h3 id="http-proxy-options">http-proxy options</h3>

<p>The following options are provided by the underlying <a href="https://github.com/nodejitsu/node-http-proxy#options">http-proxy</a> library.</p>

<ul>
  <li><strong>option.target</strong>: url string to be parsed with the url module</li>
  <li><strong>option.forward</strong>: url string to be parsed with the url module</li>
  <li><strong>option.agent</strong>: object to be passed to http(s).request (see Node’s <a href="http://nodejs.org/api/https.html#https_class_https_agent">https agent</a> and <a href="http://nodejs.org/api/http.html#http_class_http_agent">http agent</a> objects)</li>
  <li><strong>option.ssl</strong>: object to be passed to https.createServer()</li>
  <li><strong>option.ws</strong>: true/false: if you want to proxy websockets</li>
  <li><strong>option.xfwd</strong>: true/false, adds x-forward headers</li>
  <li><strong>option.secure</strong>: true/false, if you want to verify the SSL Certs</li>
  <li><strong>option.toProxy</strong>: true/false, passes the absolute URL as the <code class="highlighter-rouge">path</code> (useful for proxying to proxies)</li>
  <li><strong>option.prependPath</strong>: true/false, Default: true - specify whether you want to prepend the target’s path to the proxy path</li>
  <li><strong>option.ignorePath</strong>: true/false, Default: false - specify whether you want to ignore the proxy path of the incoming request (note: you will have to append / manually if required).</li>
  <li><strong>option.localAddress</strong> : Local interface string to bind for outgoing connections</li>
  <li><strong>option.changeOrigin</strong>: true/false, Default: false - changes the origin of the host header to the target URL</li>
  <li><strong>option.auth</strong> : Basic authentication i.e. ‘user:password’ to compute an Authorization header.</li>
  <li><strong>option.hostRewrite</strong>: rewrites the location hostname on (301/302/307/308) redirects.</li>
  <li><strong>option.autoRewrite</strong>: rewrites the location host/port on (301/302/307/308) redirects based on requested host/port. Default: false.</li>
  <li><strong>option.protocolRewrite</strong>: rewrites the location protocol on (301/302/307/308) redirects to ‘http’ or ‘https’. Default: null.</li>
  <li><strong>option.cookieDomainRewrite</strong>: rewrites domain of <code class="highlighter-rouge">set-cookie</code> headers. Possible values:
    <ul>
      <li><code class="highlighter-rouge">false</code> (default): disable cookie rewriting</li>
      <li>String: new domain, for example <code class="highlighter-rouge">cookieDomainRewrite: "new.domain"</code>. To remove the domain, use <code class="highlighter-rouge">cookieDomainRewrite: ""</code>.</li>
      <li>Object: mapping of domains to new domains, use <code class="highlighter-rouge">"*"</code> to match all domains.<br />
For example keep one domain unchanged, rewrite one domain and remove other domains:
        <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>cookieDomainRewrite: {
  "unchanged.domain": "unchanged.domain",
  "old.domain": "new.domain",
  "*": ""
}
</code></pre></div>        </div>
      </li>
    </ul>
  </li>
  <li><strong>option.headers</strong>: object, adds <a href="https://en.wikipedia.org/wiki/List_of_HTTP_header_fields#Request_fields">request headers</a>. (Example: <code class="highlighter-rouge">{host:'www.example.org'}</code>)</li>
  <li><strong>option.proxyTimeout</strong>: timeout (in millis) when proxy receives no response from target</li>
</ul>

<h2 id="shorthand">Shorthand</h2>

<p>Use the shorthand syntax when verbose configuration is not needed. The <code class="highlighter-rouge">context</code> and <code class="highlighter-rouge">option.target</code> will be automatically configured when shorthand is used. Options can still be used if needed.</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">proxy</span><span class="p">(</span><span class="s1">'http://www.example.org:8000/api'</span><span class="p">);</span>
<span class="c1">// proxy('/api', {target: 'http://www.example.org:8000'});</span>


<span class="nx">proxy</span><span class="p">(</span><span class="s1">'http://www.example.org:8000/api/books/*/**.json'</span><span class="p">);</span>
<span class="c1">// proxy('/api/books/*/**.json', {target: 'http://www.example.org:8000'});</span>


<span class="nx">proxy</span><span class="p">(</span><span class="s1">'http://www.example.org:8000/api'</span><span class="p">,</span> <span class="p">{</span><span class="na">changeOrigin</span><span class="p">:</span><span class="kc">true</span><span class="p">});</span>
<span class="c1">// proxy('/api', {target: 'http://www.example.org:8000', changeOrigin: true});</span>
</code></pre></div></div>

<h3 id="appusepath-proxy">app.use(path, proxy)</h3>

<p>If you want to use the server’s <code class="highlighter-rouge">app.use</code> <code class="highlighter-rouge">path</code> parameter to match requests; 
Create and mount the proxy without the http-proxy-middleware <code class="highlighter-rouge">context</code> parameter:</p>
<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="s1">'/api'</span><span class="p">,</span> <span class="nx">proxy</span><span class="p">({</span><span class="na">target</span><span class="p">:</span><span class="s1">'http://www.example.org'</span><span class="p">,</span> <span class="na">changeOrigin</span><span class="p">:</span><span class="kc">true</span><span class="p">}));</span>
</code></pre></div></div>

<p><code class="highlighter-rouge">app.use</code> documentation:</p>
<ul>
  <li>express: http://expressjs.com/en/4x/api.html#app.use</li>
  <li>connect: https://github.com/senchalabs/connect#mount-middleware</li>
</ul>

<h2 id="websocket">WebSocket</h2>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// verbose api</span>
<span class="nx">proxy</span><span class="p">(</span><span class="s1">'/'</span><span class="p">,</span> <span class="p">{</span><span class="na">target</span><span class="p">:</span><span class="s1">'http://echo.websocket.org'</span><span class="p">,</span> <span class="na">ws</span><span class="p">:</span><span class="kc">true</span><span class="p">});</span>

<span class="c1">// shorthand</span>
<span class="nx">proxy</span><span class="p">(</span><span class="s1">'http://echo.websocket.org'</span><span class="p">,</span> <span class="p">{</span><span class="na">ws</span><span class="p">:</span><span class="kc">true</span><span class="p">});</span>

<span class="c1">// shorter shorthand</span>
<span class="nx">proxy</span><span class="p">(</span><span class="s1">'ws://echo.websocket.org'</span><span class="p">);</span>
</code></pre></div></div>

<h3 id="external-websocket-upgrade">External WebSocket upgrade</h3>

<p>In the previous WebSocket examples, http-proxy-middleware relies on a initial http request in order to listen to the http <code class="highlighter-rouge">upgrade</code> event. If you need to proxy WebSockets without the initial http request, you can subscribe to the server’s http <code class="highlighter-rouge">upgrade</code> event manually.</p>
<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">var</span> <span class="nx">wsProxy</span> <span class="o">=</span> <span class="nx">proxy</span><span class="p">(</span><span class="s1">'ws://echo.websocket.org'</span><span class="p">,</span> <span class="p">{</span><span class="na">changeOrigin</span><span class="p">:</span><span class="kc">true</span><span class="p">});</span>

<span class="kd">var</span> <span class="nx">app</span> <span class="o">=</span> <span class="nx">express</span><span class="p">();</span>
    <span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="nx">wsProxy</span><span class="p">);</span>

<span class="kd">var</span> <span class="nx">server</span> <span class="o">=</span> <span class="nx">app</span><span class="p">.</span><span class="nx">listen</span><span class="p">(</span><span class="mi">3000</span><span class="p">);</span>
    <span class="nx">server</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">'upgrade'</span><span class="p">,</span> <span class="nx">wsProxy</span><span class="p">.</span><span class="nx">upgrade</span><span class="p">);</span>  <span class="c1">// &lt;-- subscribe to http 'upgrade'</span>
</code></pre></div></div>

<h2 id="working-examples">Working examples</h2>

<p>View and play around with <a href="https://github.com/chimurai/http-proxy-middleware/tree/master/examples">working examples</a>.</p>

<ul>
  <li>Browser-Sync (<a href="https://github.com/chimurai/http-proxy-middleware/tree/master/examples/browser-sync/index.js">example source</a>)</li>
  <li>express (<a href="https://github.com/chimurai/http-proxy-middleware/tree/master/examples/express/index.js">example source</a>)</li>
  <li>connect (<a href="https://github.com/chimurai/http-proxy-middleware/tree/master/examples/connect/index.js">example source</a>)</li>
  <li>WebSocket (<a href="https://github.com/chimurai/http-proxy-middleware/tree/master/examples/websocket/index.js">example source</a>)</li>
</ul>

<h2 id="recipes">Recipes</h2>

<p>View the <a href="https://github.com/chimurai/http-proxy-middleware/tree/master/recipes">recipes</a> for common use cases.</p>

<h2 id="compatible-servers">Compatible servers</h2>

<p><code class="highlighter-rouge">http-proxy-middleware</code> is compatible with the following servers:</p>
<ul>
  <li><a href="https://www.npmjs.com/package/connect">connect</a></li>
  <li><a href="https://www.npmjs.com/package/express">express</a></li>
  <li><a href="https://www.npmjs.com/package/browser-sync">browser-sync</a></li>
  <li><a href="https://www.npmjs.com/package/lite-server">lite-server</a></li>
  <li><a href="https://www.npmjs.com/package/grunt-contrib-connect">grunt-contrib-connect</a></li>
  <li><a href="https://www.npmjs.com/package/grunt-browser-sync">grunt-browser-sync</a></li>
  <li><a href="https://www.npmjs.com/package/gulp-connect">gulp-connect</a></li>
  <li><a href="https://www.npmjs.com/package/gulp-webserver">gulp-webserver</a></li>
</ul>

<p>Sample implementations can be found in the <a href="https://github.com/chimurai/http-proxy-middleware/tree/master/recipes/servers.md">server recipes</a>.</p>

<h2 id="tests">Tests</h2>

<p>Run the test suite:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># install dependencies</span>
<span class="nv">$ </span>npm install
</code></pre></div></div>

<p>unit testing</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># unit tests</span>
<span class="nv">$ </span>npm <span class="nb">test</span>
</code></pre></div></div>

<p>coverage</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># code coverage</span>
<span class="nv">$ </span>npm run cover
</code></pre></div></div>

<h2 id="changelog">Changelog</h2>

<ul>
  <li><a href="https://github.com/chimurai/http-proxy-middleware/blob/master/CHANGELOG.md">View changelog</a></li>
</ul>

<h2 id="license">License</h2>

<p>The MIT License (MIT)</p>

<p>Copyright (c) 2015-2017 Steven Chim</p>


      
    </div>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/anchor-js/4.1.0/anchor.min.js" integrity="sha256-lZaRhKri35AyJSypXXs4o6OPFTbTmUoltBbDCbdzegg=" crossorigin="anonymous"></script>
    <script>anchors.add();</script>
    
  </body>
</html>
